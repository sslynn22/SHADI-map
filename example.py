import geopandas as gpd
import fiona

#############################################################################
# 1) 셰이프파일 로드 (한글 인코딩 지정) ─ 주소·층수·위치가 모두 들어옴
#############################################################################
fiona.supported_drivers['ESRI Shapefile'] = 'r'                 # 인코딩 허용
gdf = gpd.read_file("CH_D010_00_20250731.shp", encoding="euc-kr")

#############################################################################
# 2) 대전광역시 조건으로 **속성 필터링**  (A4 열이 전체주소 문자열)
#############################################################################
daejeon = gdf[gdf["A4"].str.contains("대전광역시", na=False)].copy()

#############################################################################
# 3) 지상층(A25) → 건물높이(m) 계산  (지하층 A26 완전 제외)
#############################################################################
daejeon["지상층"]    = pd.to_numeric(daejeon["A25"], errors="coerce").fillna(0)
daejeon["건물높이m"] = daejeon["지상층"] * 3      # 층당 3 m 가정

#############################################################################
# 4) 결과 선택·정렬  (건물명, 지상층, 높이만 보기 좋게)
#############################################################################
cols = ["A24", "지상층", "건물높이m"]        # A24 = 건물명
result = (daejeon[cols]
          .rename(columns={"A24": "건물명"})
          .sort_values("건물높이m", ascending=False)
          .reset_index(drop=True))

print(result.head(20))       # 상위 20개만 미리보기
